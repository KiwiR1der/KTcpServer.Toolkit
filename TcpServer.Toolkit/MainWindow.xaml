<hc:Window
    x:Class="KTcpServer.Toolkit.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:hc="https://handyorg.github.io/handycontrol"
    xmlns:local="clr-namespace:KTcpServer.Toolkit"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="TcpServer.Toolkit"
    Width="800"
    Height="550"
    FontFamily="HarmonyOS Sans SC"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">
    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <StackPanel Grid.Column="0">
            <!--  控制区域  -->
            <GroupBox Margin="0,0,0,10" Header="服务器控制">
                <StackPanel Orientation="Horizontal">
                    <ToggleButton
                        Margin="5"
                        HorizontalAlignment="Left"
                        Background="{DynamicResource PrimaryBrush}"
                        Command="{Binding ToggleServerCommand}"
                        Content="启动服务器"
                        Cursor="Hand"
                        Foreground="{DynamicResource TextIconBrush}"
                        IsChecked="{Binding IsServerRunning, Mode=OneWay}"
                        Style="{StaticResource ToggleButtonPrimary}" />
                    <TextBlock
                        Margin="10,0,0,0"
                        VerticalAlignment="Center"
                        FontWeight="Bold"
                        Text="{Binding StatusText}" />
                </StackPanel>
            </GroupBox>
            <!--  日志区域  -->
            <GroupBox Height="400" Header="通信日志">
                <ListBox
                    Grid.Row="0"
                    Margin="0,0,0,10"
                    ItemsSource="{Binding LogMessages}"
                    ScrollViewer.CanContentScroll="True"
                    VirtualizingStackPanel.IsVirtualizing="True">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock
                                Margin="2"
                                Text="{Binding}"
                                TextWrapping="Wrap" />
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </GroupBox>
        </StackPanel>
        <!--  右侧客户端管理与发送  -->
        <StackPanel Grid.Column="1" Margin="10,0,0,0">
            <GroupBox Header="已连接客户端">
                <ListView
                    Height="150"
                    ItemsSource="{Binding ConnectedClients}"
                    SelectedItem="{Binding SelectedClient}">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Width="Auto">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}" TextWrapping="Wrap" />
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                        </GridView>
                    </ListView.View>

                </ListView>
            </GroupBox>
            <GroupBox Margin="0,10,0,0" Header="发送报文">
                <StackPanel>
                    <TextBox
                        Margin="0,0,0,5"
                        hc:InfoElement.Placeholder="请输入要发送的报文..."
                        IsEnabled="{Binding IsServerRunning}"
                        Text="{Binding MessageToSend, UpdateSourceTrigger=PropertyChanged}" />
                    <Button
                        HorizontalAlignment="Stretch"
                        Background="{DynamicResource PrimaryBrush}"
                        Command="{Binding SendCommand}"
                        Content="发送到选中客户端"
                        Foreground="{DynamicResource TextIconBrush}"
                        IsEnabled="{Binding IsServerRunning}"
                        Style="{StaticResource ButtonPrimary}" />
                </StackPanel>
            </GroupBox>
        </StackPanel>
    </Grid>
</hc:Window>

